\documentclass[10pt]{article}
\usepackage[letterpaper]{geometry}
\geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
\usepackage{setspace}
\usepackage{ragged2e}
\usepackage{color}
\usepackage{titlesec}
\usepackage{graphicx}
\usepackage{float}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage[font=small,labelfont=bf,labelsep=period]{caption}
\usepackage[english]{babel}
\usepackage{indentfirst}
\usepackage{array}
\usepackage{makecell}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{multirow}
\usepackage{tabularx}
\usepackage{arydshln}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{xfrac}
\usepackage{etoolbox}
\usepackage{cite}
\usepackage{url}
\usepackage{dcolumn}
\usepackage{hyperref}
\usepackage{courier}
\usepackage{url}
\usepackage{esvect}
\usepackage{commath}
\usepackage{verbatim} % for block comments
\usepackage{enumitem}
\usepackage{hyperref} % for clickable table of contents
\usepackage{braket}
\usepackage{titlesec}
\usepackage{booktabs}
\usepackage{gensymb}
\usepackage{longtable}

% for circled numbers
\usepackage{tikz}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}


\titleclass{\subsubsubsection}{straight}[\subsection]

% define new command for triple sub sections
\newcounter{subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection.\arabic{subsubsubsection}}
\renewcommand\theparagraph{\thesubsubsubsection.\arabic{paragraph}} % optional; useful if paragraphs are to be numbered

\titleformat{\subsubsubsection}
  {\normalfont\normalsize\bfseries}{\thesubsubsubsection}{1em}{}
\titlespacing*{\subsubsubsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{5}{\z@}%
  {3.25ex \@plus1ex \@minus.2ex}%
  {-1em}%
  {\normalfont\normalsize\bfseries}}
\renewcommand\subparagraph{\@startsection{subparagraph}{6}{\parindent}%
  {3.25ex \@plus1ex \@minus .2ex}%
  {-1em}%
  {\normalfont\normalsize\bfseries}}
\def\toclevel@subsubsubsection{4}
\def\toclevel@paragraph{5}
\def\toclevel@paragraph{6}
\def\l@subsubsubsection{\@dottedtocline{4}{7em}{4em}}
\def\l@paragraph{\@dottedtocline{5}{10em}{5em}}
\def\l@subparagraph{\@dottedtocline{6}{14em}{6em}}
\makeatother

\newcommand{\volume}{\mathop{\ooalign{\hfil$V$\hfil\cr\kern0.08em--\hfil\cr}}\nolimits}

\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
\begin{document}

\title{ME 280a: HW 1}
\author{April Novak}

\maketitle

\section{Introduction and Objectives}

The purpose of this study is to solve a simple finite element (FE) problem and perform a convergence study to determine the number of elements needed to reach a specific tolerance. The Galerkin FE method is used, which for certain classes of problems possesses the ``best approximation property,'' a characteristic that signifies that the FE solution obtained is the best possible solution for a given mesh refinement and choice of shape functions. The mathematical procedure and numerical implementation is described in Section \ref{sec:Procedure}.

\section{Procedure}
\label{sec:Procedure}

This section details the problem statement and mathematical method used for solving the problem.

\subsection{Problem Statement}

This section describes the mathematical process used to solve the following problem:

\begin{equation}
\label{eq:Problem}
\frac{d}{dx}\left(E(x)\frac{du}{dx}\right)=k^2\sin{\left(\frac{2\pi kx}{L}\right)}
\end{equation}

where \(E\) is the modulus of elasticity, \(u\) is the solution, \(k\) is a known constant, \(L\) is the problem domain length, and \(x\) is the spatial variable. In order to verify that the program functions correctly, it is instructive to determine the analytical solution to Eq. \eqref{eq:Problem}. To determine the analytical solution, integrate Eq. \eqref{eq:Problem} once to obtain:

\begin{equation}
\label{eq:Problem2}
\frac{du}{dx}=-\frac{1}{E}k^2\cos{\left(\frac{2\pi kx}{L}\right)}\frac{L}{2\pi k}+C_1
\end{equation}

It has been assumed that \(E\) is not a function of \(x\), and hence can be treated as constant in the integration. Integrating once more:

\begin{equation}
\label{eq:Problem2}
u(x)=-\frac{1}{E}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\left(\frac{L}{2\pi k}\right)^2+C_1x+C_2
\end{equation}

The boundary conditions for this problem are Dirichlet at both endpoints, such that:

\begin{equation}
\begin{aligned}
u(0)=0\\
u(L)=1\\
\end{aligned}
\end{equation}

By the first BC, \(C_2=0\), and \(C_1\) based on the second condition equals:

\begin{equation}
C_1=\frac{u(L)+k^2\sin{(2\pi k)}\left(\frac{L}{2\pi k E}\right)^2}{L}
\end{equation}

The purpose of this assignment is to solve Eq. \eqref{eq:Problem} with the FEM and then to perform a convergence study based on an error estimate relating the FE solution to the analytical solution given in Eq. \eqref{eq:Problem2}.

\subsection{Finite Element Implementation}

The Galerkin FE method (FEM) achieves the best approximation property by approximating the true solution \(u(x)\) as \(u^N(x)\), where both \(u^N(x)\) and the test function \(\psi\) are expanded in the same set of basis functions \(\phi\):

\begin{equation}
\label{eq:approx}
\begin{aligned}
u\approx u^N=\sum_{j=1}^{N}a_j\phi_j\\
\psi=\sum_{i=1}^{N}b_i\phi_i\\
\end{aligned}
\end{equation}

Galerkin's method is stated as:

\begin{equation}
r^N\cdot u^N=0
\end{equation}

where \(r^N\) is the residual. Hence, to formulate the weak form to Eq. \eqref{eq:Problem}, multiply Eq. \eqref{eq:Problem} through by \(\psi\) and integrate over all space, \(d\Omega\).

\begin{equation}
\int_{\Omega}^{}\frac{d}{dx}\left(E(x)\frac{du}{dx}\right)\psi d\Omega-\int_{\Omega}^{}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\psi d\Omega=0
\end{equation}

Applying integration by parts to the first term:

\begin{equation}
-\int_{\Omega}^{}E(x)\frac{du}{dx}\frac{d\psi}{dx}d\Omega+\int_{\partial\Omega}^{}E(x)\frac{du}{dx}\psi d(\partial\Omega)-\int_{\Omega}^{}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\psi d\Omega=0
\end{equation}

where \(\partial\Omega\) refers to one dimension lower than \(\Omega\), which for this case refers to evaluation at the endpoints of the domain. Hence, for this particular 1-D problem, the above reduces to:

\begin{equation}
\begin{aligned}
-\int_{0}^{L}E(x)\frac{du}{dx}\frac{d\psi}{dx}dx+ E(x)\frac{du}{dx}\psi\biggr\vert_{0}^{L}-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\psi dx=0\\
\int_{0}^{L}E(x)\frac{du}{dx}\frac{d\psi}{dx}dx=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\psi dx+E(x)\frac{du}{dx}\psi\biggr\vert_{0}^{L}\\
\end{aligned}
\end{equation}

Inserting the approximation described in Eq. \eqref{eq:approx}:

\begin{equation}
\begin{aligned}
\int_{0}^{L}E(x)\frac{d\left(\sum_{j=1}^{N}a_j\phi_j\right)}{dx}\frac{d\left(\sum_{i=1}^{N}b_i\phi_i\right)}{dx}dx=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\sum_{i=1}^{N}b_i\phi_idx+E(x)\frac{du}{dx}\sum_{i=1}^{N}b_i\phi_i\biggr\vert_{0}^{L}\\
\end{aligned}
\end{equation}

Recognizing that \(b_i\) appears in each term, the sum of the remaining terms must also equal zero (i.e. basically cancel \(b_i\) from each term).

\begin{equation}
\begin{aligned}
\int_{0}^{L}E(x)\frac{d\left(\sum_{j=1}^{N}a_j\phi_j\right)}{dx}\frac{d\phi_i}{dx}dx=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\phi_idx+E(x)\frac{du}{dx}\phi_j\biggr\vert_{0}^{L}\\
\end{aligned}
\end{equation}

This equation can be satisfied for each choice of \(j\), and hence can be reduced to:

\begin{equation}
\begin{aligned}
\int_{0}^{L}E(x)\frac{d\left(a_j\phi_j\right)}{dx}\frac{d\phi_i}{dx}dx=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\phi_idx+E(x)\frac{du}{dx}\phi_j\biggr\vert_{0}^{L}\\
\end{aligned}
\end{equation}

This produces a system of matrix equations of the form:

\begin{equation}
\label{eq:MatrixEqn}
\textbf{K}\vv{a}=\vv{F}
\end{equation}

where:

\begin{equation}
\begin{aligned}
K_{ij}=\int_{0}^{L}E(x)\frac{d\phi_i}{dx}\frac{d\phi_j}{dx}dx\\
a_j=a_j\\
F_i=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\phi_idx+E(x)\frac{du}{dx}\phi_j\biggr\vert_{0}^{L}\\
\end{aligned}
\end{equation}

where the second term in \(F_i\) is only applied at nodes that have Neumann boundary conditions (since \(\psi\) satisfies the homogeneous form of the essential boundary conditions). The above equation governs the entire domain. \(\textbf{K}\) is an \(n \times n\) matrix, where \(n\) is the number of global nodes. The solution is contained within \(\vv{a}\). 

In order for these equations to be useful with Gaussian quadrature, they must be transformed to the master element which exists over \(-1\leq\xi\leq1\):

\begin{equation}
\begin{aligned}
K_{ij}=\int_{0}^{L}E(x)\frac{d\phi_i}{dx}\frac{d\phi_j}{dx}dx\rightarrow\int_{-1}^{1}E(x(\xi))\frac{d\phi_i}{dx}\frac{d\phi_j}{dx}dx\left(\frac{dx}{d\xi}\frac{dx}{d\xi}\frac{d\xi}{dx}\right)\rightarrow\int_{-1}^{1}E(x(\xi))\frac{d\phi_i}{d\xi}\frac{d\phi_j}{d\xi}dx\left(\frac{d\xi}{dx}\right)\\
a_j=a_j\\
F_i=-\int_{0}^{L}k^2\sin{\left(\frac{2\pi kx}{L}\right)}\phi_idx\rightarrow-\int_{-1}^{1}k^2\sin{\left(\frac{2\pi kx(\xi)}{L}\right)}\phi_i\frac{dx}{d\xi}d\xi\\
\end{aligned}
\end{equation} 

For linear elements, the shape functions have the following form over the master element:

\begin{equation}
\begin{aligned}
N_1(\xi)=\frac{1-\xi}{2}\\
N_2(\xi)=\frac{1+\xi}{2}\\
\end{aligned}
\end{equation}

In order to apply the boundary conditions within the numerical context of the finite element method, the matrix equation in Eq. \eqref{eq:MatrixEqn} must be rewritten to reflect that some of the nodal values are actually already specified through the Dirichlet boundary conditions. 

\begin{equation}
\begin{bmatrix}
	K_{kk} & K_{ku}\\
	K_{uk} & K_{uu}\\
\end{bmatrix}
\begin{bmatrix}
	x_k\\
	x_u\\
\end{bmatrix}
=
\begin{bmatrix}
	b_k\\
	b_u\\
\end{bmatrix}
\end{equation}

where \(k\) indicates a known quantity (specified through a boundary condition) and \(u\) indicates an unknown quantity.   Explicitly expanding this equation gives:

\begin{equation}
\begin{aligned}
K_{kk}x_k+K_{ku}x_u=b_k\\
K_{uk}x_k+K_{uu}x_u=b_u\\
\end{aligned}
\end{equation}

Solving this matrix system is sometimes referred to as ``static condensation,'' since the original matrix system in Eq. \eqref{eq:MatrixEqn} must be separated into its components. The nodes at which Dirichlet conditions are specified are ``known,'' while all other nodes, including Neumann condition nodes, are ``unknown,'' since it is the value of \(u\) that we are looking to find at each node. The second of these equations is the one that is solved in this assignment, since there are no natural boundary conditions.

All the integration is performed numerically using Gaussian quadrature. For simplicity, a two-point quadrature rule is used, with the following weights \(w\) and sampling points \(x\):

\begin{equation}
\begin{aligned}
w=[1.0, 1.0]\\
x=[-\sqrt{1/3}, \sqrt{1/3}]\\
\end{aligned}
\end{equation}

The actual numerical algorithm computes the elemental \(k(i,j)\) and \(b(i)\) by looping over \(i, j\), and the quadrature points. Then, these elemental matrices are assembled into the global matrices using a connectivity matrix, which relates the local node numbering scheme to the global node numbering scheme. See the Appendix for the full code used in this assignment. The code was made highly modular in order to allow flexibility.

\subsection{Error Estimates and Convergence Criteria}

The accuracy of the FE approximation is estimated using the energy norm \(e^N\), defined as:

\begin{equation}
e^N=\frac{\|u-u^N\|}{\|u\|}
\end{equation}

where:

\begin{equation}
\|u\|=\sqrt{\int_{\Omega}^{}\frac{du}{dx}E\frac{du}{dx}}
\end{equation}

\begin{equation}
\|u-u^N\|=\sqrt{\int_{\Omega}^{}\frac{d(u-u^N)}{dx}E\frac{d(u-u^N)}{dx}}=\sqrt{\int_{\Omega}^{}\left(\frac{du}{dx}E\frac{du}{dx}-\frac{du^N}{dx}E\frac{du^N}{dx}\right)}
\end{equation}

The derivatives of the FE solution are determined according to:

\begin{equation}
\frac{du^N}{dx}=\frac{d}{dx}\sum_{j=1}^{N}a_j\phi_j(x)=\sum_{j=1}^{N}a_j\frac{d\phi_j(x)}{dx}=\sum_{j=1}^{N}a_j\frac{d\phi_j(x)}{d\xi}\frac{d\xi}{dx}
\end{equation}

while the derivative of the analytical solution is obtained from Eq. \eqref{eq:Problem2}. Convergence is defined to have been achieved for a given \(k\) and number of elements \(N\) once:

\begin{equation}
\label{eq:Convergence}
e^N=\frac{\|u-u^N\|}{\|u\|} \leq 0.05
\end{equation}

\subsection{Solution Results}

Table \ref{table:N} shows the number of elements needed to satisfy Eq. \eqref{eq:Convergence} for each \(k\).

\begin{table}[H]
\caption{Number of elements needed to reach convergence.}
\centering
\begin{tabular}{l c}
\hline\hline
k & Number of Elements\\ [0.5ex]
\hline
1 & 28\\
2 & 67\\
4 & 142\\
8 & \\
16 & \\
32 & \\
\hline
\end{tabular}
\label{table:N}
\end{table}

Fig. shows the FE solutions for \(N=2, 4, 8, 16, 32, 64, \) and \(128\) for \(k=1, 2, 4, 8, 16, 32\). The exact solution is also plotted for comparison. 


Fig. shows \(e^N\) as a function of \(N\) for each value of \(k\) represented in the previous figure.

\end{document}